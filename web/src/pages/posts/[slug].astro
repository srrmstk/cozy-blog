---
import { getPosts, getPostBySlug } from '../../lib/strapi';
import { renderMarkdown } from '../../lib/markdown';
import '../../styles/markdown.css';

export async function getStaticPaths() {
  const posts = await getPosts();

  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
}

const { slug } = Astro.params;
const post = await getPostBySlug(slug);

if (!post) {
  throw new Error(`Post not found: ${slug}`);
}

const { title, content, publishedAt } = post;
const html = renderMarkdown(content);
---

<html lang="ru">
    <head>
        <meta charset="utf-8">
    </head>
  <body>
    <article>
      <a href="/" class="back">← Назад</a>
      <h1>{title}</h1>

      <time datetime={publishedAt}>
        {new Date(publishedAt).toLocaleDateString()}
      </time>

      <div class="content" set:html={html} />
    </article>
  </body>
</html>
